# GCPデプロイ後チェックリスト（terraform apply 実行後）

## 1. Cloud Run
- [ ] サービスが作成されているか確認
- [ ] トラフィック割り当てが「0%」または「非公開」になっているか（**意図しない公開防止**）
- [ ] 最小インスタンス数が「0」になっているか（**無料枠最適化**）
- [ ] 最大インスタンス数、CPU/メモリ設定が想定通りか
- [ ] 認証（IAM/サービスアカウント）設定が適切か
- [ ] 不要なリージョン・サービスが作成されていないか

**推奨設定例・コンソール手順**:
- 公開前は「未認証呼び出しを許可しない」設定にする  
  → Cloud Runサービス詳細 > [権限]タブ > 「未認証の呼び出しを許可しない」を選択
- トラフィック割り当て0%で外部からアクセス不可に  
  → Cloud Runサービス詳細 > [トラフィック]タブ > 「新しいリビジョンに0%割り当て」または「すべてのトラフィックを0%に設定」
- 最小インスタンス数を0に設定  
  → Cloud Runサービス詳細 > [編集] > [コンテナ] > 「最小インスタンス数」を0に設定

---

## 2. Cloud SQL（MySQL）
- [ ] インスタンスが作成されているか
- [ ] インスタンスサイズ（例: db-f1-micro）が無料枠内か
- [ ] 自動停止設定が有効か（**コスト最適化**）
- [ ] パブリックIPが不要なら無効化
- [ ] 不要なユーザーやDBが作成されていないか

**推奨設定例・コンソール手順**:
- テスト・開発時は自動停止を有効化  
  → Cloud SQLインスタンス詳細 > [編集] > 「アイドル時に自動停止」を有効化
- パブリックIPは極力無効化  
  → Cloud SQLインスタンス詳細 > [接続] > 「パブリックIP」セクションで無効化

---

## 3. Cloud Storage
- [ ] バケットが作成されているか
- [ ] バケットが「非公開」になっているか（**意図しない公開防止**）
- [ ] バージョニングが無効になっているか（**コスト最適化**）
- [ ] ライフサイクルルール（自動削除）が設定されているか
- [ ] 不要なバケットやファイルが存在しないか

**推奨設定例・コンソール手順**:
- バケットは「全ユーザー公開」になっていないか必ず確認  
  → Cloud Storageバケット詳細 > [権限]タブ > 「allUsers」「allAuthenticatedUsers」がないことを確認
- バージョニングを無効化  
  → バケット詳細 > [設定] > 「バージョニング」をオフ
- ライフサイクルで古いファイル自動削除  
  → バケット詳細 > [ライフサイクル]タブ > 「ルールを追加」から自動削除ルールを設定

---

## 4. IAM（サービスアカウント・権限）
- [ ] サービスアカウントが作成されているか
- [ ] 必要最小限の権限のみ付与されているか
- [ ] 不要なサービスアカウントやキーが存在しないか

**推奨設定例・コンソール手順**:
- サービスアカウントキーは必要時のみ発行し、不要になったら削除  
  → IAM & 管理 > サービスアカウント > 対象アカウント > [キー]タブ > 不要なキーを削除
- 権限は最小限のロールのみ付与  
  → IAM & 管理 > IAM > 対象アカウントのロールを確認・編集

---

## 5. Secret Manager
- [ ] シークレットが作成されているか
- [ ] シークレット値が最新か
- [ ] 不要なシークレットが存在しないか

**推奨設定例・コンソール手順**:
- シークレット値は定期的にローテーション  
  → Secret Manager > 対象シークレット > [新しいバージョンを追加]
- 不要なバージョンは削除  
  → Secret Manager > 対象シークレット > [バージョン]タブ > 不要なバージョンを無効化または削除

---

## 6. Cloud CDN / ロードバランサ
- [ ] CDN/ロードバランサが意図通りに作成されているか
- [ ] 不要なIPや転送ルールが存在しないか
- [ ] キャッシュ設定が最適化されているか

**推奨設定例・コンソール手順**:
- 不要なIP/ロードバランサは削除  
  → ネットワーキング > ロードバランサ > 不要なリソースを選択し削除
- キャッシュ設定でトラフィック・コスト最適化  
  → ロードバランサ詳細 > [バックエンド] > [キャッシュ設定]を最適化

---

## 7. モニタリング・コスト管理
- [ ] モニタリング/アラートが有効になっているか
- [ ] コストアラートが設定されているか
- [ ] 不要なログ出力が有効になっていないか

**推奨設定例・コンソール手順**:
- Cloud Monitoringでリソース消費を監視  
  → Monitoring > ダッシュボード作成やアラートポリシー設定
- コストアラートで予期せぬ課金を防止  
  → 請求 > 予算とアラート > 予算を作成しアラートを設定

---

## 8. その他
- [ ] Terraformの状態ファイル（terraform.tfstate）が最新か
- [ ] 手動で作成したリソースが不要なら削除
- [ ] 予期せぬリソースが作成されていないか

---

### 備考
- 本番公開前は「非公開」設定・最小構成で運用し、必要時のみ公開・スケールアップすることを推奨。
- すべてのリソースはGCPコンソールで最終確認し、不要なものは必ず削除してください。 