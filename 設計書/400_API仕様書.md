# 400_API仕様書

## 目的
本ドキュメントは、TraMemoプロジェクトのRESTful API仕様の共通的な設計方針・ルールをまとめ、開発・運用・保守の指針とすることを目的とします。

---

## 1. 基本情報
- **ベースURL**: `/api`
- **認証方式**: Clerk認証（JWTトークン）
- **レスポンス形式**: JSON
- **文字エンコーディング**: UTF-8

---

## 2. 認証
### Clerk認証
リクエストヘッダーにClerkのJWTトークンを含める必要があります。
```
Authorization: Bearer <clerk_jwt_token>
```
- 認証必須エンドポイントは `clerk.auth` ミドルウェアで保護

---

## 3. 共通レスポンス
### 成功レスポンス
```json
{
    "success": true,
    "data": { ... },
    "message": "操作が成功しました"
}
```
### エラーレスポンス
```json
{
    "success": false,
    "message": "エラーメッセージ",
    "errors": {
        "field": ["エラー詳細"]
    }
}
```
### ステータスコード一覧
| コード | 説明 |
|--------|------|
| 200 | OK（成功） |
| 201 | Created（作成成功） |
| 400 | Bad Request（リクエストエラー） |
| 401 | Unauthorized（認証エラー） |
| 404 | Not Found（リソースが見つからない） |
| 422 | Unprocessable Entity（バリデーションエラー） |
| 500 | Internal Server Error（サーバーエラー） |

---

## 4. エラーコード例

### バリデーションエラー（422）
```json
{
    "success": false,
    "message": "The given data was invalid.",
    "errors": {
        "title": ["The title field is required."]
    }
}
```

### 認証エラー（401）
```json
{
    "success": false,
    "message": "Unauthorized"
}
```

### リソース未発見（404）
```json
{
    "success": false,
    "message": "Not Found"
}
```

---

## 5. 注意事項
- 認証必須のエンドポイントは有効なClerk JWTトークンが必要
- 日付形式は `YYYY-MM-DD`、時刻形式は `HH:MM` で指定
- 画像URLは外部の有効なURLを指定
- 緯度・経度は数値で指定
- 定数値（visibility, location_category, prefecture, country）は定数ファイルの値を使用

---

## 6. 今後の拡張予定
- 旅行記録の更新・削除API
- いいね・お気に入り機能
- コメント機能
- 検索・フィルター機能
- 画像アップロード機能

---

*（最終更新日: 2024-07-xx）* 